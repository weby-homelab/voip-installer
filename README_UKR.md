# üõ°Ô∏è VoIP Server Installer

[![Version](https://img.shields.io/github/v/tag/weby-homelab/voip-installer?label=version&style=flat-square)](https://github.com/weby-homelab/voip-installer/tags)
[![ShellCheck](https://img.shields.io/github/actions/workflow/status/weby-homelab/voip-installer/lint.yml?label=ShellCheck&style=flat-square)](https://github.com/weby-homelab/voip-installer/actions/workflows/lint.yml)
[![Test Deploy](https://img.shields.io/github/actions/workflow/status/weby-homelab/voip-installer/test-install.yml?label=Test%20Deploy&style=flat-square)](https://github.com/weby-homelab/voip-installer/actions/workflows/test-install.yml)
[![License](https://img.shields.io/github/license/weby-homelab/voip-installer?style=flat-square)](LICENSE)

**–ë–µ–∑–ø–µ—á–Ω–µ —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Asterisk –Ω–∞ Ubuntu 24.04**

> –ì–æ—Ç–æ–≤–∏–π —É—Å—Ç–∞–Ω–æ–≤–Ω–∏–∫ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ VoIP-—Å–µ—Ä–≤–µ—Ä–∞: **Asterisk 22** (Docker) + **PJSIP** + —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è **TLS/SRTP** + **Let's Encrypt** SSL + **Fail2Ban** —Ç–∞ **NFTables**. –°—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.

---

# üìû –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Asterisk

**–í–µ—Ä—Å—ñ—è:** `v4.7.7` (–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ TLS —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç: –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤, –∫–æ—Ä–µ–∫—Ç–Ω—ñ –ø—Ä–∞–≤–∞)

–¶—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–ø–∏—Å—É—î –ø—Ä–æ—Ü–µ—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó —Å–µ—Ä–≤–µ—Ä–∞ VoIP (**Asterisk 22** + **PJSIP** + **TLS/SRTP** + **Fail2Ban** + **NFTables**) –Ω–∞ —á–∏—Å—Ç–∏–π —Å–µ—Ä–≤–µ—Ä **Ubuntu 24.04**.

### üåü –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –≤–µ—Ä—Å—ñ—ó

* **–°—É–≤–æ—Ä–∏–π Firewall:** –ü–æ–ª—ñ—Ç–∏–∫–∞ `DROP` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ä—Ç—É SSH –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è.
* **–ê–≤—Ç–æ-–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î Docker, Docker Compose, Certbot, Fail2Ban —Ç–∞ NFTables.
* **Safe Mode:** –ù–µ —Å–∫–∏–¥–∞—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–µ—Ä–µ–∂—ñ Docker (no flush ruleset).
* **–†–æ—Ç–∞—Ü—ñ—è –ª–æ–≥—ñ–≤:** –õ—ñ–º—ñ—Ç 100MB –¥–ª—è Systemd Journal —Ç–∞ Docker –ª–æ–≥—ñ–≤.
* **–ë–µ–∑–ø–µ–∫–∞:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î TLS 1.3 –Ω–∞ –ø–æ—Ä—Ç—É `5061`.
* **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è SSL —á–µ—Ä–µ–∑ Let's Encrypt.

---

## üõ† –ö—Ä–æ–∫ 1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

1. **–£–≤—ñ–π–¥—ñ—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä** —á–µ—Ä–µ–∑ SSH –ø—ñ–¥ root:
```bash
ssh root@your-server-ip

```


2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Ä—Ç–∏:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –ø–æ—Ä—Ç–∏ `80`, `443` —Ç–∞ `5061` –≤—ñ–ª—å–Ω—ñ.
> *–ü—Ä–∏–º—ñ—Ç–∫–∞: –Ø–∫—â–æ —Ü–µ —á–∏—Å—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏, –ø–æ—Ä—Ç–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –≤—ñ–ª—å–Ω—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.*



---

## üìù –ö—Ä–æ–∫ 2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—É

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–æ—Ä–æ–∂–Ω—ñ–π —Ñ–∞–π–ª –¥–ª—è —Å–∫—Ä–∏–ø—Ç—É:
```bash
nano install.sh

```


2. **–°–∫–æ–ø—ñ—é–π—Ç–µ** –ü–û–í–ù–ò–ô –∫–æ–¥ —Å–∫—Ä–∏–ø—Ç—É `v4.7.7` (`install.sh`) —É –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É.
3. **–í—Å—Ç–∞–≤—Ç–µ** –∫–æ–¥ —É —Ç–µ—Ä–º—ñ–Ω–∞–ª:
* **Windows** (PuTTY/PowerShell): –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **–ü–†–ê–í–£** –∫–Ω–æ–ø–∫—É –º–∏—à—ñ.
* **Mac/Linux:** `Cmd+V` –∞–±–æ `Ctrl+Shift+V`.


4. **–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ç–∞ –∑–∞–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª**:
* –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å `Ctrl+O`, –ø–æ—Ç—ñ–º `Enter`.
* –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å `Ctrl+X`.



---

## üöÄ –ö—Ä–æ–∫ 3. –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. –ù–∞–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
```bash
chmod +x install.sh

```


2. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç** (–∑–∞–º—ñ–Ω—ñ—Ç—å –¥–∞–Ω—ñ –Ω–∞ —Å–≤–æ—ó):
```bash
./install.sh --domain your-domain.com --email admin@your-domain.com

```


**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞–ø—É—Å–∫—É:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å |
| :--- | :--- |
| `--domain` | –í–∞—à–µ –¥–æ–º–µ–Ω–Ω–µ —ñ–º'—è (–æ–±–æ–≤'—è–∑–∫–æ–≤–æ, –º–∞—î –±—É—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞). |
| `--email` | –ü–æ—à—Ç–∞ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ Let's Encrypt. |
| `--ext-ip` | *(–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)* –ó–æ–≤–Ω—ñ—à–Ω—ñ–π IP, —è–∫—â–æ —Å–µ—Ä–≤–µ—Ä –∑–∞ NAT. –ó–∞–∑–≤–∏—á–∞–π –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. |

---

## ‚öôÔ∏è –ö—Ä–æ–∫ 4. –©–æ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

–°–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω–∞—î –Ω–∞—Å—Ç—É–ø–Ω—ñ –¥—ñ—ó –±–µ–∑ –≤–∞—à–æ—ó —É—á–∞—Å—Ç—ñ:

1. üê≥ –í—Å—Ç–∞–Ω–æ–≤–∏—Ç—å **Docker**, **Docker Compose**, **Certbot**, **Fail2Ban** —Ç–∞ **NFTables**.
2. üîí –û—Ç—Ä–∏–º–∞—î **SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç** —á–µ—Ä–µ–∑ Certbot.
3. üë§ –ó–≥–µ–Ω–µ—Ä—É—î –ø–∞—Ä–æ–ª—ñ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ **100-105**.
4. üõ°Ô∏è –ù–∞–ª–∞—à—Ç—É—î firewall (—Ç–∞–±–ª–∏—Ü—è `inet voip_firewall`), **–Ω–µ –ª–∞–º–∞—é—á–∏ Docker**.
5. ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å **Asterisk** —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ.

---

## ‚úÖ –ö—Ä–æ–∫ 5. –ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

### 1. –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ SIP

–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –ø–∞—Ä–æ–ª—ñ:

```bash
cat /root/voip-server/users.env

```


### 2. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω–∏–π —Ç–∞ –ø—Ä–∞—Ü—é—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ:

```bash
docker ps

```

> **–û—á—ñ–∫—É—î—Ç—å—Å—è:** –°—Ç–∞—Ç—É—Å `"Up (healthy)"`.

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Firewall

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª:

```bash
nft list table inet voip_firewall

```

### üö® 3.1. –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (Docker Network Safety)

–í–∏–∫–æ–Ω–∞–π—Ç–µ —Ü—ñ –∫–æ–º–∞–Ω–¥–∏, —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ firewall –Ω–µ –∑–∞–±–ª–æ–∫—É–≤–∞–≤ –º–µ—Ä–µ–∂—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º:

```bash
systemctl restart nftables
docker exec asterisk-voip curl -Is https://google.com | grep HTTP

```

* **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `HTTP/2 200` (–∞–±–æ `HTTP/1.1 200`).
* **–ß–æ–º—É —Ü–µ –ø—Ä–∞—Ü—é—î:**
* *Host network:* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—Ç–µ–∫/IP —Ö–æ—Å—Ç–∞.
* *Used accept:* –í–∏—Ö—ñ–¥–Ω–∏–π curl -> SYN -> –∑–±—ñ–≥ 'established' –ø—Ä–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—ñ.
* *No block outbound:* –ü–æ–ª—ñ—Ç–∏–∫–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º accept (Safe Mode).



> **–£—Å–ø—ñ—Ö:** –Ø–∫—â–æ —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å ‚Äî Safe Mode –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞—Ö–∏—â–∞—î –º–µ—Ä–µ–∂–µ–≤—É –∑–≤'—è–∑–Ω—ñ—Å—Ç—å Docker.

### 4. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Linphone)

–ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Å–æ—Ñ—Ç—Ñ–æ–Ω, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –¥–∞–Ω—ñ:

* **Username:** `100` (–∞–±–æ 101-105)
* **Password:** *(–∑ —Ñ–∞–π–ª—É users.env)*
* **Domain:** `your-domain.com:5061`
* **Transport:** `TLS`
* **Media Encryption:** `SRTP`
* **AVPF:** Disabled (–∑–∞–∑–≤–∏—á–∞–π)
* **ICE:** Enabled

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤ —Å–µ—Ä–≤–µ—Ä–∞

–ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º —É —Ç–µ—Ü—ñ `/root/voip-server/`:

```text
/root/voip-server/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ asterisk/
‚îÇ       ‚îú‚îÄ‚îÄ pjsip.conf          # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SIP (–ø–æ—Ä—Ç–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç)
‚îÇ       ‚îú‚îÄ‚îÄ extensions.conf     # –õ–æ–≥—ñ–∫–∞ –¥—ñ–∞–ª–ø–ª–∞–Ω—É (–¥–∑–≤—ñ–Ω–∫—ñ–≤)
‚îÇ       ‚îú‚îÄ‚îÄ modules.conf        # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤
‚îÇ       ‚îú‚îÄ‚îÄ logger.conf         # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–≤
‚îÇ       ‚îî‚îÄ‚îÄ rtp.conf            # –î—ñ–∞–ø–∞–∑–æ–Ω RTP –ø–æ—Ä—Ç—ñ–≤
‚îú‚îÄ‚îÄ certs/                      # SSL –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ (Let's Encrypt)
‚îú‚îÄ‚îÄ data/                       # –ë–∞–∑–∏ –¥–∞–Ω–∏—Ö Asterisk —Ç–∞ —Å—Ö–æ–≤–∏—â–µ
‚îú‚îÄ‚îÄ logs/                       # –õ–æ–≥–∏ (–±–µ–∑–ø–µ–∫–∞, –¥–∑–≤—ñ–Ω–∫–∏/CDR)
‚îú‚îÄ‚îÄ qr_codes/                   # QR-–∫–æ–¥–∏ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—ñ–≤
‚îú‚îÄ‚îÄ users.env                   # SIP –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ –ø–∞—Ä–æ–ª—ñ
‚îî‚îÄ‚îÄ docker-compose.yml          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–∞–ø—É—Å–∫—É Docker
```

---

## üèó –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –≤–∏–±—ñ—Ä –æ–±—Ä–∞–∑—É

–£ –ø—Ä–æ—î–∫—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **`andrius/asterisk:22`** (–Ω–∞ –±–∞–∑—ñ Alpine Linux) –∑–∞–º—ñ—Å—Ç—å –≤–µ–ª–∏–∫–æ–≤–∞–≥–æ–≤–∏—Ö –∑–±—ñ—Ä–æ–∫ FreePBX. –¶–µ —Å–≤—ñ–¥–æ–º–∏–π –≤–∏–±—ñ—Ä –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å **–±–µ–∑–ø–µ–∫–∏** —Ç–∞ **–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ**.

```mermaid
graph TD
    User[SIP –ö–ª—ñ—î–Ω—Ç / –°–æ—Ñ—Ç—Ñ–æ–Ω]
    Net[–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç / WAN]
    FW[NFTables Firewall]
    F2B[Fail2Ban]
    
    subgraph Server [Ubuntu 24.04 Host]
        FW -->|"–î–æ–∑–≤–æ–ª–∏—Ç–∏ TLS 5061"| Docker
        FW -->|"–î–æ–∑–≤–æ–ª–∏—Ç–∏ RTP 10000-20000"| Docker
        FW -->|"–ë–ª–æ–∫—É–≤–∞—Ç–∏ –∞—Ç–∞–∫–∏"| Drop[DROP]
        
        F2B -.->|"–ß–∏—Ç–∞—î –ª–æ–≥–∏"| Logs
        F2B -.->|"–û–Ω–æ–≤–ª—é—î –±–∞–Ω-–ª–∏—Å—Ç"| FW
        
        subgraph Docker Container [Asterisk 22]
            PJSIP[PJSIP Stack]
            RTP[RTP Engine]
            Logs[Asterisk Logs]
        end
        
        Docker ---|"–†–µ–∂–∏–º Host Network"| FW
    end
    
    User -->|"TLS –°–∏–≥–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è"| Net
    User -->|"SRTP –ì–æ–ª–æ—Å (–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π)"| Net
    Net --> FW
```

### –ß–æ–º—É –Ω–µ FreePBX?
–û—Ñ—ñ—Ü—ñ–π–Ω—ñ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∏ (FreePBX) –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ GUI, —Ç—è–≥–Ω—É—Ç—å –∑–∞ —Å–æ–±–æ—é Apache, MySQL, PHP —Ç–∞ NodeJS, –∑–∞–π–º–∞—é—á–∏ **>1 –ì–ë**. –¶–µ —Å—Ç–≤–æ—Ä—é—î –≤–µ–ª–∏—á–µ–∑–Ω—É –ø–æ–≤–µ—Ä—Ö–Ω—é –¥–ª—è –∞—Ç–∞–∫ —Ç–∞ —É—Å–∫–ª–∞–¥–Ω—é—î –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é.

### –ü–µ—Ä–µ–≤–∞–≥–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è:
* üöÄ **–õ–µ–≥–∫–æ–≤–∞–≥—ñ—Å—Ç—å:** –û–±—Ä–∞–∑ –≤–∞–∂–∏—Ç—å –ª–∏—à–µ **~60 –ú–ë** (–ø—Ä–æ—Ç–∏ 1 –ì–ë+ —É –∞–Ω–∞–ª–æ–≥—ñ–≤).
* ‚ö° **Alpine Linux & Musl:** –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è RAM —Ç–∞ –º–∏—Ç—Ç—î–≤–∏–π —Å—Ç–∞—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
* üõ°Ô∏è **–ë–µ–∑–ø–µ–∫–∞ (Hardened):** –£ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ **–Ω–µ–º–∞—î –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É**, –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –∑–∞–π–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤. –ó–ª–∞–º–∞—Ç–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –Ω–µ–º–æ–∂–ª–∏–≤–æ, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–µ–±—É –ø—Ä–æ—Å—Ç–æ –Ω–µ–º–∞—î.
* üìÑ **Infrastructure as Code (IaC):** –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ `.conf` —Ñ–∞–π–ª–∏. –¶–µ –Ω–∞–¥—ñ–π–Ω—ñ—à–µ, –Ω—ñ–∂ –ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö FreePBX.
* üîß **–ß–∏—Å—Ç–∏–π PJSIP:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Å—É—á–∞—Å–Ω–∏–π —Å—Ç–µ–∫ SIP –±–µ–∑ –ª–µ–≥–∞—Å—ñ-–∫–æ–¥—É `chan_sip`.

> **–ü—ñ–¥—Å—É–º–æ–∫:** –¶–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è —ñ–Ω–∂–µ–Ω–µ—Ä—ñ–≤, —è–∫–∏–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–∞–¥—ñ–π–Ω–∏–π, —à–≤–∏–¥–∫–∏–π —Ç–∞ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–π VoIP-—Å–µ—Ä–≤–µ—Ä, —â–æ –ø—Ä–∞—Ü—é—î –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º "–ø–æ—Å—Ç–∞–≤–∏–≤ —ñ –∑–∞–±—É–≤".

---

## üîß –í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º (Troubleshooting)

* **–ù–µ–º–∞—î –∑–≤—É–∫—É:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥—ñ–∞–ø–∞–∑–æ–Ω UDP `10000-19999` —É –ø–∞–Ω–µ–ª—ñ –≤–∞—à–æ–≥–æ —Ö–æ—Å—Ç–∏–Ω–≥—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Hetzner Firewall / AWS Security Group).
* **–ü–æ–º–∏–ª–∫–∞ SSL:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –¥–æ–º–µ–Ω –ø—ñ–Ω–≥—É—î—Ç—å—Å—è –∑ —Å–∞–º–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
* **–õ–æ–≥–∏ Asterisk:**
```bash
docker logs -f asterisk-voip

```

---

# üêô –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Asterisk –∑ GitHub

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `weby-homelab/voip-installer`
**–ú–µ—Ç–∞:** –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç –Ω–∞ —á–∏—Å—Ç–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ Ubuntu 24.04

–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ GitHub (`git clone`) ‚Äî —Ü–µ –Ω–∞–±–∞–≥–∞—Ç–æ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ—à–µ —Ç–∞ –Ω–∞–¥—ñ–π–Ω—ñ—à–µ, –Ω—ñ–∂ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –≤—Ä—É—á–Ω—É. –¶–µ –≤–∏–∫–ª—é—á–∞—î –ø–æ–º–∏–ª–∫–∏ –∫–æ–¥—É–≤–∞–Ω–Ω—è —Ç–∞ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –æ—Å—Ç–∞–Ω–Ω—é –≤–µ—Ä—Å—ñ—é –∫–æ–¥—É.

–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø—Ä—è–º–æ –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

### üìã –í–∏–º–æ–≥–∏

* –ß–∏—Å—Ç–∏–π —Å–µ—Ä–≤–µ—Ä **Ubuntu 24.04**.
* –ü—Ä–∞–≤–∞ **root**.
* –î–æ–º–µ–Ω, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞.

---

## üöÄ –í–∞—Ä—ñ–∞–Ω—Ç 1: –®–≤–∏–¥–∫–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü–µ–π –º–µ—Ç–æ–¥ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è. –ú–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–º–æ git, –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–º–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —Ç–∞ –≤—ñ–¥—Ä–∞–∑—É –∑–∞–ø—É—Å—Ç–∏–º–æ —Å–∫—Ä–∏–ø—Ç.

### –ö—Ä–æ–∫ 1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–∞ –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è

–í–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥–∏ —É –∫–æ–Ω—Å–æ–ª—ñ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# 1. –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–∫–∏ –ø–∞–∫–µ—Ç—ñ–≤ —Ç–∞ —Å—Ç–∞–≤–∏–º–æ git
apt update && apt install -y git

# 2. –ö–ª–æ–Ω—É—î–º–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
git clone https://github.com/weby-homelab/voip-installer.git

# 3. –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –≤ –ø–∞–ø–∫—É
cd voip-installer

```


### –ö—Ä–æ–∫ 2. –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏





–ù–∞–¥–∞—î–º–æ –ø—Ä–∞–≤–∞ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–∫—Ä–∏–ø—Ç –∑ –≤–∞—à–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:





```bash


# 1. –†–æ–±–∏–º–æ —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º


chmod +x install.sh





# 2. –ó–∞–ø—É—Å–∫–∞—î–º–æ (–ó–ê–ú–Ü–ù–Ü–¢–¨ email —Ç–∞ domain –ù–ê –°–í–û–á!)


./install.sh --email admin@your-domain.com --domain your-domain.com


```





---





## ‚ö° –í–∞—Ä—ñ–∞–Ω—Ç 2: "One-Liner" (–¥–ª—è –ø—Ä–æ—Ñ—ñ)





–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å–µ –æ–¥–Ω–∏–º —Ä—è–¥–∫–æ–º (–∑—Ä—É—á–Ω–æ –¥–ª—è –º–∞—Å–æ–≤–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∞–±–æ —Å–∫—Ä–∏–ø—Ç—ñ–≤ cloud-init):





```bash


apt update && apt install -y git && \


git clone https://github.com/weby-homelab/voip-installer.git && \


cd voip-installer && \


chmod +x install.sh && \


./install.sh --email admin@your-domain.com --domain your-domain.com


```

---

## ‚úÖ –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ —Å–∫—Ä–∏–ø—Ç –≤—ñ–¥–ø—Ä–∞—Ü—é—î, —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏—Å—è –∞–±–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–ø–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é, –∞–±–æ –≤ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —à–ª—è—Ö–∞—Ö (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ª–æ–≥—ñ–∫–∏ —Å–∫—Ä–∏–ø—Ç—É).

1. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É:**
```bash
docker ps

```


*(–ú–∞—î –±—É—Ç–∏ —Å—Ç–∞—Ç—É—Å `Up (healthy)`)*
2. **–ü–æ—à—É–∫ –ø–∞—Ä–æ–ª—ñ–≤ SIP:**
–ó–∞–∑–≤–∏—á–∞–π —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä—É—î —Ñ–∞–π–ª `users.env`. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –π–æ–≥–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å:
```bash
# –í–∞—Ä—ñ–∞–Ω—Ç –ê (—É –ø–æ—Ç–æ—á–Ω—ñ–π –ø–∞–ø—Ü—ñ)
cat users.env

# –í–∞—Ä—ñ–∞–Ω—Ç –ë (—É –ø–∞–ø—Ü—ñ /root/voip-server, —è–∫—â–æ —Å–∫—Ä–∏–ø—Ç —Å—Ç–≤–æ—Ä—é—î —ó—ó)
cat /root/voip-server/users.env

```


3. **–¢–µ—Å—Ç –±–µ–∑–ø–µ–∫–∏ –º–µ—Ä–µ–∂—ñ (Safe Mode):**
```bash
docker exec asterisk-voip curl -Is https://google.com | grep HTTP

```



---

## üí° –ü–æ—Ä–∞–¥–∞ —â–æ–¥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

–Ø–∫—â–æ –≤–∏ –æ–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–ø—Ä–∞–≤–∏—Ç–µ –±–∞–≥–∏ –∞–±–æ –¥–æ–¥–∞—Å—Ç–µ —Ñ—ñ—á—ñ), –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–∏–∫–æ–Ω–∞—Ç–∏:

```bash
cd ~/voip-installer
git pull
# –ü–æ—Ç—ñ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

```
